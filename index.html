<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•™êµ ì‹œì„¤ ì•ˆë‚´ í‚¤ì˜¤ìŠ¤í¬</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Inter í°íŠ¸ ì„¤ì • ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
            color: #1e293b;
        }
        .kiosk-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° (í‚¤ì˜¤ìŠ¤í¬ í™˜ê²½ ìµœì í™”) */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        /* ë·° ì „í™˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .tab-btn {
            /* í¬ê¸° ë° ê¸€ê¼´ í™•ëŒ€: p-4 md:p-6, text-xl, font-extraboldë¡œ ë³€ê²½ */
            @apply p-4 md:p-6 rounded-t-lg text-xl font-extrabold flex-1 text-center transition duration-150 ease-in-out cursor-pointer;
        }
        .tab-btn.active {
            @apply bg-white text-indigo-700 shadow-inner border-b-4 border-indigo-500;
        }
        .tab-btn:not(.active) {
            @apply bg-indigo-50 text-gray-600 hover:bg-indigo-100;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col p-4 md:p-8">

    <!-- Header Section -->
    <header class="bg-indigo-700 text-white p-6 rounded-xl shadow-lg mb-6 flex justify-between items-center">
        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">
            ğŸ« ìº í¼ìŠ¤ ì•ˆë‚´ ë° ì†Œí†µ í‚¤ì˜¤ìŠ¤í¬
        </h1>
        <div class="text-lg opacity-90 hidden md:block">
            <span id="current-time"></span>
        </div>
    </header>

    <!-- Main Application Area -->
    <main class="flex-grow flex flex-col gap-6">
        
        <!-- View Tabs -->
        <div class="flex bg-white rounded-t-xl overflow-hidden shadow-lg">
            <div id="tab-building" class="tab-btn active" onclick="switchView('building')">ğŸ¢ í˜¸ê´€ ì•ˆë‚´</div>
            <div id="tab-calendar" class="tab-btn" onclick="switchView('calendar')">ğŸ“… í•™ì‚¬ ì¼ì •</div>
            <div id="tab-suggestion" class="tab-btn" onclick="switchView('suggestion')">âœ‰ï¸ ê±´ì˜í•¨</div>
        </div>

        <!-- Content Area: Stacking Panels Vertically -->
        <div class="flex-grow flex flex-col gap-6">

            <!-- Top Panel: Building List (Fixed Height for vertical scroll) -->
            <!-- Changed lg:w-1/3 to w-full and added h-[40vh] for vertical layout -->
            <section id="building-panel" class="w-full bg-white p-6 rounded-xl kiosk-shadow flex flex-col h-[40vh] transition-opacity duration-300">
                <h2 class="text-2xl font-bold mb-4 text-indigo-800">í˜¸ê´€ ëª©ë¡</h2>
                <!-- Search Input -->
                <div class="mb-4">
                    <input type="text" id="search-input" placeholder="ì‹œì„¤, í•™ê³¼ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..."
                           class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 transition duration-150 text-base"
                           onkeyup="filterBuildings()">
                </div>
                <!-- Building List Container -->
                <div id="building-list" class="space-y-3 overflow-y-auto no-scrollbar flex-grow">
                    <!-- Building buttons will be populated here by JavaScript -->
                </div>
            </section>

            <!-- Bottom Panel: Dynamic Content (Takes remaining space) -->
            <!-- Changed lg:w-2/3 to w-full and added flex-grow -->
            <section id="content-panel" class="w-full bg-white p-8 rounded-xl kiosk-shadow flex-grow overflow-y-auto no-scrollbar">
                <!-- Initial/Default Building Details View -->
                <div id="building-details">
                    <h2 class="text-3xl font-bold text-gray-500 mb-4">í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                    <p class="text-xl text-gray-600">ìƒë‹¨ ëª©ë¡ì—ì„œ ê±´ë¬¼ì„ ì„ íƒí•˜ê±°ë‚˜ íƒ­ì„ ì´ìš©í•˜ì—¬ ì›í•˜ëŠ” ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                </div>
                <!-- Calendar View (Hidden by default) -->
                <div id="calendar-view" class="hidden">
                    <h2 class="text-4xl font-extrabold text-indigo-700 mb-6">ğŸ“… 2025ë…„ 12ì›” í•™ì‚¬ ì¼ì •</h2>
                    <div id="calendar-events" class="space-y-4">
                        <!-- Events will be populated here -->
                    </div>
                </div>
                <!-- Suggestion View (Hidden by default) -->
                <div id="suggestion-view" class="hidden">
                    <h2 class="text-4xl font-extrabold text-indigo-700 mb-6">âœ‰ï¸ ê±´ì˜ ë° ì œì•ˆí•˜ê¸°</h2>
                    <p class="text-xl text-gray-700 mb-6">í•™êµ ë°œì „ì„ ìœ„í•œ ì†Œì¤‘í•œ ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”. ìµëª…ìœ¼ë¡œ ì²˜ë¦¬ë˜ë©°, ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ê²€í† í•˜ê² ìŠµë‹ˆë‹¤.</p>
                    <form id="suggestion-form" class="space-y-4">
                        <div>
                            <label for="suggestion-type" class="block text-lg font-medium text-gray-700 mb-1">ë¶„ë¥˜</label>
                            <select id="suggestion-type" required
                                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 transition duration-150 text-lg">
                                <option value="" disabled selected>ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ì‹œì„¤">ì‹œì„¤ ê°œì„ </option>
                                <option value="í•™ì‚¬">í•™ì‚¬/ìˆ˜ì—…</option>
                                <option value="ë³µì§€">í•™ìƒ ë³µì§€</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€ ì˜ê²¬</option>
                            </select>
                        </div>
                        <div>
                            <label for="suggestion-title" class="block text-lg font-medium text-gray-700 mb-1">ì œëª©</label>
                            <input type="text" id="suggestion-title" required placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                                   class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 transition duration-150 text-lg">
                        </div>
                        <div>
                            <label for="suggestion-content" class="block text-lg font-medium text-gray-700 mb-1">ë‚´ìš©</label>
                            <textarea id="suggestion-content" rows="6" required placeholder="ìƒì„¸í•œ ê±´ì˜ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš” (ìµœì†Œ 10ì)"
                                      class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 transition duration-150 text-lg"></textarea>
                        </div>
                        <button type="submit" id="submit-btn"
                                class="w-full bg-green-600 text-white py-3 rounded-lg font-bold text-xl hover:bg-green-700 transition duration-150">
                            ì œì•ˆ ì œì¶œí•˜ê¸°
                        </button>
                        <p id="submission-message" class="text-center text-lg mt-4 hidden"></p>
                    </form>
                </div>
            </section>
        </div>

    </main>

    <!-- Footer: Daily Menu Banner -->
    <footer class="mt-6">
        <div id="daily-menu-footer" 
             class="bg-orange-500 text-white p-3 rounded-xl shadow-lg 
                    flex flex-col md:flex-row items-center justify-center space-y-2 md:space-y-0 md:space-x-8">
            <!-- Content will be injected here by JavaScript -->
        </div>
    </footer>

    <!-- Firebase SDK Scripts (ë°ì´í„° ì €ì¥ ë¡œì§ í¬í•¨) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, doc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Global Variables (Mandatory)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, userId;
        const suggestionsForm = document.getElementById('suggestion-form');
        const submissionMessage = document.getElementById('submission-message');
        const submitButton = document.getElementById('submit-btn');

        // Firestore Initialization and Authentication
        async function initializeFirebase() {
            if (!firebaseConfig) {
                console.error("Firebase configuration not found. Suggestion feature disabled.");
                submissionMessage.textContent = "ì˜¤ë¥˜: ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.";
                submissionMessage.classList.remove('hidden', 'text-green-600');
                submissionMessage.classList.add('text-red-600');
                submitButton.disabled = true;
                return;
            }
            
            // For debug logging
            setLogLevel('Debug');

            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            try {
                if (initialAuthToken) {
                    const userCredential = await signInWithCustomToken(auth, initialAuthToken);
                    userId = userCredential.user.uid;
                } else {
                    const userCredential = await signInAnonymously(auth);
                    userId = userCredential.user.uid;
                }
                console.log("Firebase initialized. User ID:", userId);

            } catch (error) {
                console.error("Firebase Auth Error:", error);
                userId = crypto.randomUUID(); // Fallback to random ID
            }
            
            // Set up form submission handler after auth is ready
            suggestionsForm.addEventListener('submit', handleSuggestionSubmit);
        }

        // Suggestion Submission Logic (â˜… ì´ ë¶€ë¶„ì´ ë°ì´í„°ë¥¼ Firestoreì— ì €ì¥í•˜ëŠ” í•µì‹¬ ë¡œì§ì…ë‹ˆë‹¤. â˜…)
        async function handleSuggestionSubmit(event) {
            event.preventDefault();

            if (!db || !userId) {
                submissionMessage.textContent = "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
                submissionMessage.classList.remove('hidden', 'text-green-600');
                submissionMessage.classList.add('text-red-600');
                return;
            }
            
            const type = document.getElementById('suggestion-type').value;
            const title = document.getElementById('suggestion-title').value;
            const content = document.getElementById('suggestion-content').value;

            submitButton.disabled = true;
            submitButton.textContent = 'ì œì¶œ ì¤‘...';
            submissionMessage.classList.add('hidden');

            // Firestore Path: /artifacts/{appId}/users/{userId}/suggestions
            const suggestionsCollectionRef = collection(db, 'artifacts', appId, 'users', userId, 'suggestions');

            const suggestionData = {
                type: type,
                title: title,
                content: content,
                timestamp: new Date().toISOString(),
                userId: userId,
                status: 'New'
            };

            try {
                // ë°ì´í„°ë¥¼ Firestoreì— ì¶”ê°€í•˜ëŠ” ë¹„ë™ê¸° í˜¸ì¶œ
                await addDoc(suggestionsCollectionRef, suggestionData);
                
                submissionMessage.textContent = 'âœ… ê±´ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!';
                submissionMessage.classList.remove('hidden', 'text-red-600');
                submissionMessage.classList.add('text-green-600');
                
                // Reset form and UI
                suggestionsForm.reset();
            } catch (error) {
                console.error("Error submitting suggestion: ", error);
                submissionMessage.textContent = 'âŒ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
                submissionMessage.classList.remove('hidden', 'text-green-600');
                submissionMessage.classList.add('text-red-600');
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'ì œì•ˆ ì œì¶œí•˜ê¸°';
            }
        }
        
        // Start Firebase initialization
        initializeFirebase();
    </script>
    
    <!-- Core Application JavaScript -->
    <script>
        // --- 1. Building Data (í˜¸ê´€ ëª©ë¡) ---
        const buildingData = [
            {
                id: 'A',
                name: 'ì œ1í˜¸ê´€ (ë³¸ê´€)',
                nickname: 'í–‰ì • ë° ê²½ì˜',
                facilities: [
                    { name: 'ì´ì¥ì‹¤', floor: '4ì¸µ', description: 'í•™êµ ìµœê³  ì˜ì‚¬ ê²°ì • ê¸°êµ¬' },
                    { name: 'êµë¬´ì²˜', floor: '3ì¸µ', description: 'í•™ì‚¬ ë° êµì§ì› ê´€ë¦¬' },
                    { name: 'ì…í•™ê´€ë¦¬íŒ€', floor: '1ì¸µ', description: 'ì‹ ì…ìƒ ë° í¸ì…ìƒ ì—…ë¬´' },
                    { name: 'ëŒ€ê°•ë‹¹', floor: 'B1ì¸µ', description: 'ì£¼ìš” í–‰ì‚¬ ë° ê°•ì—° ì¥ì†Œ' },
                ],
            },
            {
                id: 'B',
                name: 'ì œ2í˜¸ê´€ (ê³µí•™ê´€)',
                nickname: 'IT ë° ê³µí•™',
                facilities: [
                    { name: 'ì»´í“¨í„°ê³µí•™ê³¼ ì‚¬ë¬´ì‹¤', floor: '5ì¸µ', description: 'ì»´í“¨í„° ê´€ë ¨ í•™ê³¼ êµí•™íŒ€' },
                    { name: 'ì „ìê³µí•™ê³¼ ì‹¤ìŠµì‹¤', floor: '4ì¸µ', description: 'ìµœì‹  ì¥ë¹„ê°€ êµ¬ë¹„ëœ ì‹¤ìŠµ ê³µê°„' },
                    { name: '4ì°¨ì‚°ì—…í˜ëª… ì—°êµ¬ì†Œ', floor: '3ì¸µ', description: 'ë¯¸ë˜ ê¸°ìˆ  ì—°êµ¬ í—ˆë¸Œ' },
                    { name: 'PC ì‹¤ìŠµì‹¤', floor: '2ì¸µ', description: 'í•™ìƒ ê³µìš© ì»´í“¨í„°ì‹¤' },
                ],
            },
            {
                id: 'C',
                name: 'ì œ3í˜¸ê´€ (ì¸ë¬¸ê´€)',
                nickname: 'ì¸ë¬¸ ì‚¬íšŒ ê³„ì—´',
                facilities: [
                    { name: 'êµ­ì–´êµ­ë¬¸í•™ê³¼ ê°•ì˜ì‹¤', floor: '5ì¸µ', description: 'êµ­ì–´ ë° ë¬¸í•™ ìˆ˜ì—…' },
                    { name: 'ì˜ì–´ì˜ë¬¸í•™ê³¼ ì‚¬ë¬´ì‹¤', floor: '4ì¸µ', description: 'ì˜ë¬¸í•™ê³¼ êµí•™íŒ€' },
                    { name: 'ì‹¬ë¦¬ìƒë‹´ì„¼í„°', floor: '2ì¸µ', description: 'í•™ìƒ ì •ì‹  ê±´ê°• ìƒë‹´ì†Œ' },
                    { name: 'ì—´ëŒì‹¤ (ì¼ë¶€)', floor: '3ì¸µ', description: 'ê°„ë‹¨í•œ ë…ì„œ ë° í•™ìŠµ ê³µê°„' },
                ],
            },
            {
                id: 'D',
                name: 'ì œ4í˜¸ê´€ (í•™ìƒíšŒê´€)',
                nickname: 'ë³µì§€ ë° í¸ì˜ ì‹œì„¤',
                facilities: [
                    { name: 'í•™ìƒ ì‹ë‹¹', floor: '1ì¸µ', description: 'ë‹¤ì–‘í•œ ë©”ë‰´ì˜ í•™ìƒ ì‹ë‹¹' },
                    { name: 'í•™ìƒíšŒì‹¤', floor: '2ì¸µ', description: 'í•™ìƒ ìì¹˜ í™œë™ ê³µê°„' },
                    { name: 'ë™ì•„ë¦¬ë°©', floor: '3ì¸µ', description: 'ê°ì¢… ë™ì•„ë¦¬ ì „ìš© ê³µê°„' },
                    { name: 'í¸ì˜ì ', floor: '1ì¸µ', description: 'ê°„ë‹¨í•œ ì‹ìŒë£Œ ë° ìƒí•„í’ˆ íŒë§¤' },
                ],
            },
        ];

        // --- 2. Academic Calendar Data (í•™ì‚¬ ì¼ì •) ---
        // 2025ë…„ 12ì›” ê¸°ì¤€ ë°ì´í„° (ì˜¤ëŠ˜ ë‚ ì§œ: 2025ë…„ 12ì›” 2ì¼ í™”ìš”ì¼)
        const academicCalendarData = [
            { date: '12ì›” 2ì¼ (ì›”)', event: '2í•™ê¸° ê¸°ë§ê³ ì‚¬ ì‹œì‘ (1ì£¼ì°¨)' },
            { date: '12ì›” 6ì¼ (ê¸ˆ)', event: '2í•™ê¸° ê¸°ë§ê³ ì‚¬ ì¢…ë£Œ (1ì£¼ì°¨)' },
            { date: '12ì›” 9ì¼ (ì›”)', event: '2í•™ê¸° ê¸°ë§ê³ ì‚¬ ì‹œì‘ (2ì£¼ì°¨)' },
            { date: '12ì›” 13ì¼ (ê¸ˆ)', event: '2í•™ê¸° ê¸°ë§ê³ ì‚¬ ì¢…ë£Œ (ìµœì¢…)' },
            { date: '12ì›” 16ì¼ (ì›”)', event: 'ê²¨ìš¸ ê³„ì ˆí•™ê¸° ë“±ë¡ ë° ìˆ˜ê°• ì‹ ì²­ ì‹œì‘' },
            { date: '12ì›” 20ì¼ (ê¸ˆ)', event: 'ì„±ì  ì—´ëŒ ë° ì´ì˜ ì‹ ì²­ ê¸°ê°„ ì‹œì‘' },
            { date: '12ì›” 24ì¼ (í™”)', event: 'ê²¨ìš¸ë°©í•™ ì‹œì‘' },
            { date: '12ì›” 25ì¼ (ìˆ˜)', event: 'ì„±íƒ„ì ˆ (í•™êµ íœ´ë¬´ì¼)' },
            { date: '12ì›” 31ì¼ (í™”)', event: '2í•™ê¸° ì„±ì  í™•ì • ë° ê²Œì‹œ' },
        ];
        
        // --- 2.5. Daily Menu Data (ì˜¤ëŠ˜ì˜ í•™ì‹) ---
        const dailyMenuData = [
            { meal: 'ì ì‹¬ (Lunch)', time: '11:30~13:30', menu: 'ì œìœ¡ë®ë°¥, ì½©ë‚˜ë¬¼êµ­, ì˜¤ì´ë¬´ì¹¨, ë°°ì¶”ê¹€ì¹˜, ìš”êµ¬ë¥´íŠ¸', price: '5,500ì›' },
            { meal: 'ì €ë… (Dinner)', time: '17:30~19:00', menu: 'ëˆê¹ŒìŠ¤&ì˜¤ë¯€ë¼ì´ìŠ¤, ì½˜í¬ë¦¼ìŠ¤í”„, ìƒëŸ¬ë“œ, í”¼í´, ë‹¨ë¬´ì§€', price: '6,000ì›' },
        ];


        // --- 3. View Management and UI Logic ---
        let currentActiveBuildingId = null;
        let currentView = 'building';
        const buildingListContainer = document.getElementById('building-list');
        const buildingDetailsContainer = document.getElementById('building-details');
        const buildingPanel = document.getElementById('building-panel');
        const calendarView = document.getElementById('calendar-view');
        const suggestionView = document.getElementById('suggestion-view');
        const searchInput = document.getElementById('search-input');
        
        // Function to switch between main views
        function switchView(viewName) {
            currentView = viewName;
            
            // íƒ­ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${viewName}`).classList.add('active');

            // ë‚´ìš© íŒ¨ë„ í‘œì‹œ/ìˆ¨ê¹€
            buildingDetailsContainer.classList.add('hidden');
            calendarView.classList.add('hidden');
            suggestionView.classList.add('hidden');

            if (viewName === 'building') {
                buildingPanel.classList.remove('hidden');
                buildingDetailsContainer.classList.remove('hidden');
                // í˜¸ê´€ ë·°ë¡œ ëŒì•„ì™”ì„ ë•Œ, ì´ì „ì— ì„ íƒëœ í˜¸ê´€ì„ ë³´ì—¬ì£¼ê±°ë‚˜ ê¸°ë³¸ ë©”ì‹œì§€ë¥¼ í‘œì‹œ
                if (currentActiveBuildingId) {
                    showBuildingDetails(currentActiveBuildingId);
                } else {
                    showDefaultBuildingMessage();
                }
                searchInput.value = ''; // ê²€ìƒ‰ì°½ ì´ˆê¸°í™”
                renderBuildingList(buildingData);
            } else if (viewName === 'calendar') {
                buildingPanel.classList.add('hidden');
                calendarView.classList.remove('hidden');
                renderAcademicCalendar();
            } else if (viewName === 'suggestion') {
                buildingPanel.classList.add('hidden');
                suggestionView.classList.remove('hidden');
                document.getElementById('submission-message').classList.add('hidden'); // ë©”ì‹œì§€ ìˆ¨ê¹€
                document.getElementById('suggestion-form').reset();
            }